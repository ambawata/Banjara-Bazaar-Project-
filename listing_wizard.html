<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banjara Bazaar - New Product Listing Wizard</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    
    <style>
        /* Custom Styles - Overriding or extending Tailwind for specific elements */
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #FACC15; /* Corrected: yellow-50 */
            color: #333; 
        }
        .logo { 
            font-family: 'Playfair Display', serif; 
            color: #92400E; 
        }
        
        /* Progress Bar Styling */
        .progress-bar-section { 
            margin-bottom: 2rem; 
        }
        .progress-steps-container {
            display: flex; 
            justify-content: space-between; 
            align-items: flex-start; 
            position: relative; 
            margin-top: 1.5rem; 
        }
        .progress-step { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            position: relative; 
            flex-shrink: 0; 
            width: 20%; 
            text-align: center;
            color: #6B7280; 
        }
        .progress-circle { 
            width: 2rem; 
            height: 2rem; 
            border-radius: 9999px; 
            background-color: #E5E7EB; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: 600; 
            z-index: 10; 
            transition: all 0.3s ease; 
        }
        .progress-label { 
            font-size: 0.75rem; 
            margin-top: 0.5rem; 
            white-space: nowrap; 
        }
        .progress-line { 
            position: absolute; 
            top: 1rem; 
            height: 0.125rem; 
            background-color: #E5E7EB; 
            z-index: 1; 
            width: calc(20% - 1.5rem); 
            transform: translateX(-50%);
        }
        #progressLine1 { left: calc(20% * 0.5 + 0.5rem); } 
        #progressLine2 { left: calc(20% * 1.5 + 0.5rem); }
        #progressLine3 { left: calc(20% * 2.5 + 0.5rem); }
        #progressLine4 { left: calc(20% * 3.5 + 0.5rem); }

        /* Progress States */
        .progress-step.active .progress-circle,
        .progress-step.completed .progress-circle { 
            background-color: #FACC15; 
            color: #000000; 
        }
        .progress-step.active .progress-label,
        .progress-step.completed .progress-label { 
            font-weight: 600; 
            color: #D97706; 
        }
        .progress-line.completed { 
            background-color: #FACC15; 
        }

        /* Button Styles */
        .main-btn { 
            background-color: #FACC15; 
            color: #000000; 
            font-weight: 600; 
            padding: 0.75rem 1.5rem; 
            border-radius: 0.5rem; 
            border: none; 
            cursor: pointer; 
            transition: background-color 0.2s ease; 
        }
        .main-btn:hover { background-color: #EAB308; }
        .main-btn:disabled { background-color: #D1D5DB; color: #6B7280; cursor: not-allowed; }
        .secondary-btn { 
            background-color: #E5E7EB; 
            color: #1F2937; 
            font-weight: 600; 
            padding: 0.75rem 1.5rem; 
            border-radius: 0.5rem; 
            border: none; 
            cursor: pointer; 
            transition: background-color 0.2s ease; 
        }
        .secondary-btn:hover { background-color: #D1D5DB; }
        .hidden { display: none; }

        /* Accordion Styles */
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out; }
        .accordion-header.active + .accordion-content { max-height: 1000px; transition: max-height 0.5s ease-in; } 
        .arrow { transition: transform 0.3s ease; }
        .accordion-header.active .arrow { transform: rotate(180deg); }

        /* General form styles to ensure consistency */
        .form-group { margin-bottom: 1.5rem; }
        .form-label { 
            display: block; 
            font-size: 0.875rem; 
            font-weight: 500; 
            color: #374151; 
            margin-bottom: 0.5rem; 
        }
        .form-input { 
            display: block; 
            width: 100%; 
            padding: 0.75rem; 
            border: 1px solid #D1D5DB; 
            border-radius: 0.375rem; 
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); 
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .form-input:focus {
            outline: none;
            border-color: #FACC15; 
            box-shadow: 0 0 0 3px rgba(250, 204, 21, 0.5); 
        }

        /* --- STEP 3 PRICING DISPLAY (Example text) --- */
        .mrp-example-text { 
            margin-top: 0.25rem;
            font-size: 0.75rem; /* text-xs */
            color: #6B7280; /* gray-500 */
        }
        .mrp-example-text s { 
            color: #EF4444; /* red-500 */
            text-decoration: line-through;
        }
        .mrp-example-text .selling-price-display-example { 
            font-weight: 600; /* font-semibold */
            color: #16A34A; /* green-700 */
        }

        /* --- STEP 1 IMAGE UPLOADER SPECIFIC STYLES --- */
        .upload-slot { 
            position: relative; 
            width: 100%;
            aspect-ratio: 1 / 1;
            border: 2px dashed #D1D5DB; 
            border-radius: 0.5rem; 
            display: flex;
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            text-align: center;
            color: #9CA3AF; 
            cursor: pointer;
            background-color: #F9FAFB;
        }
        .upload-slot:hover { border-color: #FACC15; }
        .upload-slot img { width: 100%; height: 100%; object-fit: cover; border-radius: 0.5rem; }
        .remove-btn { 
            position: absolute; 
            top: 0.25rem; 
            right: 0.25rem; 
            background-color: rgba(0,0,0,0.6); 
            color: white; 
            border-radius: 9999px; 
            width: 1.5rem; 
            height: 1.5rem; 
            line-height: 1.5rem; 
            text-align: center; 
            font-weight: bold; 
            border: none; 
            cursor: pointer; 
        }
        .main-image-label { 
            position: absolute;
            bottom: 0.25rem;
            left: 0.25rem;
            background-color: #FACC15; 
            color: #000000;
            font-size: 0.65rem;
            font-weight: 600;
            padding: 0.1rem 0.4rem;
            border-radius: 0.25rem;
            z-index: 20;
        }
        /* Style for the inner content of empty slots */
        .upload-slot > div.empty-slot-content { 
            display: flex;
            flex-direction: column;
            align-items: center; 
            justify-content: center; 
            width: 100%; 
            height: 100%; 
            padding: 0.5rem; 
        }
        .upload-slot > div.empty-slot-content span.text-4xl {
            margin-bottom: 0.25rem; 
            color: #9CA3AF; 
        }
        .upload-slot > div.empty-slot-content span.block.text-xs {
            color: #6B7280; 
        }

        /* --- STEP 4 DIMENSIONS UNIT TOGGLE --- */
        .dimensions-label-group {
            display: flex;
            align-items: center; 
            gap: 0.5rem; 
            margin-bottom: 0.5rem; 
        }
        .dimensions-label-group .form-label {
            margin-bottom: 0; 
            flex-shrink: 0; 
        }
        .unit-toggle-select {
            padding: 0.4rem 0.6rem;
            border: 1px solid #D1D5DB;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            background-color: #F9FAFB;
            cursor: pointer;
            height: 38px; 
            box-sizing: border-box; 
        }
        .unit-toggle-select:focus {
            outline: none;
            border-color: #FACC15; 
            box-shadow: 0 0 0 3px rgba(250, 204, 21, 0.5); 
        }
        /* Ensure dimension inputs are not too small */
        .dimensions-input-group input[type="number"] {
            flex-grow: 1; 
            min-width: 60px; 
        }
        /* Placeholder styling for better visibility */
        .form-input::placeholder {
            color: #9CA3AF; 
            opacity: 1; 
        }
        ::-webkit-input-placeholder { color: #9CA3AF; opacity: 1; }
        ::-moz-placeholder { color: #9CA3AF; opacity: 1; }
        :-ms-input-placeholder { color: #9CA3AF; opacity: 1; }
        :-ms-input-placeholder { color: #9CA3AF; opacity: 1; }


        /* --- REVIEW PAGE SPECIFIC STYLES --- */
        .review-section-header {
            font-weight: 600;
            font-size: 1.125rem;
            color: #374151;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #E5E7EB;
        }
        .review-item {
            margin-bottom: 0.75rem;
            display: flex;
            flex-wrap: wrap; 
            align-items: baseline; 
        }
        .review-label {
            font-weight: 500;
            color: #4B5563; 
            width: 150px; 
            flex-shrink: 0; 
        }
        .review-value {
            color: #1F2937; 
            flex-grow: 1; 
        }
        .review-value.image-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .review-image {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 4px;
            border: 1px solid #E5E7EB;
        }
        .review-features-list {
            list-style: none; 
            padding-left: 0;
            margin-left: 150px; 
        }
        .review-features-list li {
            position: relative;
            padding-left: 1.5em; 
            margin-bottom: 0.25em;
        }
        .review-features-list li::before {
            content: '•'; 
            position: absolute;
            left: 0;
            color: #D97706; 
            font-weight: bold;
            font-size: 1.2em;
            line-height: 1;
        }
        /* Specific styling for nested review subsections */
        .review-subsection {
            border-left: 3px solid #FACC15; 
            padding-left: 1rem;
            margin-left: 1rem;
            margin-top: 1rem;
            padding-top: 0.5rem;
        }
        .review-subsection .review-item {
            margin-left: 0; 
        }
        .review-subsection .review-label {
            width: 130px; 
        }
    </style>
</head>
<body class="bg-yellow-50 text-gray-900"> 

    <div class="min-h-screen flex items-center justify-center px-4 py-12">
        <div class="bg-white rounded-2xl shadow-xl w-full max-w-lg p-6 md:p-8" id="stepContainer">
            
            <div class="flex justify-between items-center font-semibold mb-6">
                <a href="#" class="logo text-2xl">Banjara Bazaar</a>
                <span class="text-gray-500 text-sm">New Product Listing</span>
            </div>
            <hr class="my-6 border-gray-200" />
            
            <div class="progress-bar-section">
                <div class="progress-steps-container">
                    <div id="progressStep1" class="progress-step">
                        <div class="progress-circle">1</div>
                        <p class="progress-label">Identity</p>
                    </div>
                    <div id="progressLine1" class="progress-line"></div>
                    <div id="progressStep2" class="progress-step">
                        <div class="progress-circle">2</div>
                        <p class="progress-label">Details</p>
                    </div>
                    <div id="progressLine2" class="progress-line"></div>
                    <div id="progressStep3" class="progress-step">
                        <div class="progress-circle">3</div>
                        <p class="progress-label">Pricing</p>
                    </div>
                    <div id="progressLine3" class="progress-line"></div>
                    <div id="progressStep4" class="progress-step">
                        <div class="progress-circle">4</div>
                        <p class="progress-label">Logistics</p>
                    </div>
                    <div id="progressLine4" class="progress-line"></div>
                    <div id="progressStep5" class="progress-step">
                        <div class="progress-circle">5</div>
                        <p class="progress-label">Review</p>
                    </div>
                </div>
            </div>
            <hr class="my-6 border-gray-200" />

            <div id="step-1" class="hidden">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">Step 1: Upload Your Product Photos</h2>
                    <p class="text-gray-600 mt-2">Upload exactly 4 high-quality photos. The first image will be your main cover image.</p>
                </div>
                
                <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg text-sm text-blue-800">
                    <b>Pro Tip:</b> For best results, upload square images (1080x1080 pixels).</p>
                </div>

                <div class="mt-6">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="image-upload-slots">
                        </div>
                    <input id="file-upload" type="file" class="hidden" accept=".png, .jpg, .jpeg, .webp" multiple>
                </div>
                
                <div class="text-center mt-4 h-5">
                    <p id="upload-status-message" class="text-sm font-semibold"></p>
                </div>

                <div class="mt-8 pt-6 border-t border-gray-200 flex justify-end">
                    <button id="step1-next-btn" class="main-btn" disabled>Next: Add Product Details &rarr;</button>
                </div>
            </div>

            <div id="step-2" class="hidden">
                <div class="flex items-start gap-4 mb-8">
                    <img id="step2-main-image" src="https://placehold.co/64x64/FFFFFF/333333?text=Img" class="rounded-md border border-gray-200" alt="Product Main Image" style="width:64px; height:64px;"> 
                    <div>
                        <h2 class="text-3xl font-bold text-gray-900">Step 2: Details & Categorization</h2>
                        <p class="text-gray-600 mt-2">Confirm the AI-suggested details for your product.</p>
                    </div>
                </div>
                
                <div class="space-y-4 pt-6 border-t border-gray-200">
                    <div class="form-group">
                        <label class="form-label" for="title">Product Title <span class="text-red-500">*</span> <button class="help-btn" onclick="alert('Enter a short, descriptive name for your item without including the brand name.')">?</button></label>
                        <input type="text" id="title" class="form-input mandatory-field-step2" value="Handcrafted Wooden Serving Tray">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="description">Product Description <span class="text-red-500">*</span> <button class="help-btn" onclick="alert('Write a detailed paragraph about your product, its story, and key features.')">?</button></label>
                        <textarea id="description" rows="5" class="form-input mandatory-field-step2">A beautifully hand-painted wooden tray, perfect for serving guests or as a decorative piece. Made from sustainable Sheesham wood with intricate mosaic work.</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="features">Key Features (1 per line) <span class="text-red-500">*</span> <button class="help-btn" onclick="alert('List 3-5 key features or bullet points that highlight what makes your product special.')">?</button></label>
                        <textarea id="features" rows="4" class="form-input mandatory-field-step2">Handmade mosaic design
Durable Sheesham wood
Perfect for serving and display
Easy to clean</textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="keywords">Search Keywords <span class="text-red-500">*</span> <button class="help-btn" onclick="alert('Enter comma-separated keywords that customers might use to find your product.')">?</button></label>
                        <input type="text" id="keywords" class="form-input mandatory-field-step2" value="wooden serving tray, mosaic tray, gift set, kitchenware, home decor">
                    </div>
                    
                    <div class="pt-6 border-t border-gray-200 space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6">
                            <div class="form-group">
                                <label for="category" class="form-label">Category <span class="text-red-500">*</span> <button class="help-btn" onclick="alert('Select the most relevant category for your product.')">?</button></label>
                                <select id="category" class="form-input mandatory-field-step2"> 
                                    <option value="">-- Select Category --</option> 
                                    <option value="crockery">Crockery</option> 
                                    <option value="decor">Home Decor</option>
                                    <option value="furniture">Furniture</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-x-6">
                             <div class="form-group">
                                <label for="material" class="form-label">Material <span class="text-red-500">*</span> <button class="help-btn" onclick="alert('Specify the primary material of your product.')">?</button></label>
                                <input type="text" id="material" class="form-input mandatory-field-step2" value="Sheesham Wood">
                            </div>
                            
                            <div class="form-group">
                                <label for="color-select" class="form-label">Color Variants <span class="text-red-500">*</span> <button class="help-btn" onclick="alert('Select predefined colors or choose custom if your color is not listed.')">?</button></label>
                                <select id="color-select" class="form-input mandatory-field-step2"> 
                                    <option value="">-- Select Color --</option> 
                                    <option value="Brown">Brown</option>
                                    <option value="Black">Black</option>
                                    <option value="White">White</option>
                                    <option value="Multi-color">Multi-color</option>
                                    <option value="Red">Red</option>
                                    <option value="Blue">Blue</option>
                                    <option value="Green">Green</option>
                                    <option value="custom">Custom...</option>
                                </select>
                                <input type="text" id="custom-color-input" class="form-input mt-2 hidden" placeholder="Enter custom color">
                            </div>
                            
                            <div class="form-group">
                                <label for="size" class="form-label">Size Variants <span class="text-red-500">*</span> <button class="help-btn" onclick="alert('Select the size of your product.')">?</button></label>
                                <select id="size" class="form-input mandatory-field-step2"> 
                                    <option value="">-- Select Size --</option>
                                    <option value="small">Small</option>
                                    <option value="medium">Medium</option>
                                    <option value="large">Large</option>
                                    <option value="one-size">One Size Fits All</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-8 pt-6 border-t border-gray-200 flex justify-between items-center">
                    <button id="step2-back-btn" class="secondary-btn">&larr; Back to Images</button>
                    <button id="step2-next-btn" class="main-btn" disabled>Next: Pricing &rarr;</button>
                </div>
            </div>

            <div id="step-3" class="hidden">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">Step 3: Set Pricing, Inventory & Policies</h2>
                    <p class="text-gray-600 mt-2">Define the prices for different buyers and set your stock availability.</p>
                </div>
                
                <form class="mt-8 flex flex-col space-y-6" id="pricing-form">
                    <div class="border border-gray-200 rounded-lg">
                        <button type="button" class="accordion-header active w-full flex justify-between items-center p-4 cursor-pointer bg-gray-50">
                            <span class="font-semibold text-lg text-gray-800">Individual Buyer Pricing <span class="text-red-500">*</span></span>
                            <span class="arrow text-gray-500">▼</span>
                        </button>
                        <div class="accordion-content">
                            <div class="p-4 border-t border-gray-200">
                                <p class="mrp-example-text mb-4">
                                    Example: <s id="displayed-mrp-example">₹2000</s> <span id="displayed-selling-price-example" class="selling-price-display-example">₹1500</span>
                                </p>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6">
                                    <div class="form-group">
                                        <label for="mrp" class="form-label">MRP (Maximum Retail Price) <span class="text-red-500">*</span> <button type="button" class="help-btn" onclick="alert('The Maximum Retail Price. This will be shown to the customer with a line through it to indicate a discount.')">?</button></label>
                                        <input type="number" id="mrp" value="2000" class="form-input mandatory-field-step3">
                                    </div>
                                    <div class="form-group">
                                        <label for="selling-price" class="form-label">Selling Price <span class="text-red-500">*</span> <button type="button" class="help-btn" onclick="alert('The price an individual customer pays. This will be the base for AI suggestions.')">?</button></label>
                                        <input type="number" id="selling-price" value="1500" class="form-input mandatory-field-step3">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="border border-gray-200 rounded-lg">
                        <button type="button" class="accordion-header w-full flex justify-between items-center p-4 cursor-pointer bg-gray-50">
                            <span class="font-semibold text-lg text-gray-800">Group Buy Pricing (Optional)</span>
                            <span class="arrow text-gray-500">▼</span>
                        </button>
                        <div class="accordion-content">
                            <div class="p-4 border-t border-gray-200 space-y-4">
                                <label class="flex items-center"><input id="enable-group-buy" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-yellow-600 focus:ring-yellow-500"><span class="ml-2 text-gray-700">Enable Group Buy for this product</span></label>
                                <div id="group-buy-inputs" class="grid grid-cols-1 md:grid-cols-2 gap-x-6">
                                    <div class="form-group">
                                        <label for="group-price" class="form-label">Group Buy Price (per item) <button type="button" class="help-btn" onclick="alert('The special discounted price for members of a group buy.')">?</button></label>
                                        <input type="number" id="group-price" placeholder="AI Suggestion..." class="form-input" disabled>
                                    </div>
                                    <div class="form-group">
                                        <label for="group-moq" class="form-label">Group Buy MOQ <button type="button" class="help-btn" onclick="alert('The minimum total items the group must buy to get this price.')">?</button></label>
                                        <input type="number" id="group-moq" placeholder="e.g., 5" class="form-input" disabled>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="border border-gray-200 rounded-lg">
                        <button type="button" class="accordion-header w-full flex justify-between items-center p-4 cursor-pointer bg-gray-50">
                            <span class="font-semibold text-lg text-gray-800">Wholesale Pricing (Optional)</span>
                            <span class="arrow text-gray-500">▼</span>
                        </button>
                        <div class="accordion-content">
                            <div class="p-4 border-t border-gray-200 space-y-4">
                                <label class="flex items-center"><input id="enable-wholesale" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-yellow-600 focus:ring-yellow-500"><span class="ml-2 text-gray-700">Enable Wholesale for this product</span></label>
                                <div id="wholesale-inputs" class="grid grid-cols-1 md:grid-cols-2 gap-x-6">
                                    <div class="form-group">
                                        <label for="wholesale-price" class="form-label">Wholesale Price (per item) <button type="button" class="help-btn" onclick="alert('The best price for B2B bulk buyers.')">?</button></label>
                                        <input type="number" id="wholesale-price" placeholder="AI Suggestion..." class="form-input" disabled>
                                    </div>
                                    <div class="form-group">
                                        <label for="wholesale-moq" class="form-label">Wholesale MOQ <button type="button" class="help-btn" onclick="alert('The minimum items a single business buyer must purchase for this price.')">?</button></label>
                                        <input type="number" id="wholesale-moq" placeholder="e.g., 50" class="form-input" disabled>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="border border-gray-200 rounded-lg">
                        <button type="button" class="accordion-header w-full flex justify-between items-center p-4 cursor-pointer bg-gray-50">
                            <span class="font-semibold text-lg text-gray-800">Inventory & Policies <span class="text-red-500">*</span></span>
                            <span class="arrow text-gray-500">▼</span>
                        </button>
                        <div class="accordion-content">
                            <div class="p-4 border-t border-gray-200">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6">
                                    <div class="form-group">
                                        <label for="stock" class="form-label">Total Stock Quantity <span class="text-red-500">*</span> <button type="button" class="help-btn" onclick="alert('The total number of units you have available for sale across all tiers.')">?</button></label>
                                        <input type="number" id="stock" value="200" class="form-input mandatory-field-step3">
                                    </div>
                                    <div class="form-group">
                                        <label for="return-policy" class="form-label">Return Policy <span class="text-red-500">*</span> <button type="button" class="help-btn" onclick="alert('Select the return policy that will apply to this specific product.')">?</button></label>
                                        <select id="return-policy" class="form-input mandatory-field-step3">
                                            <option value="">-- Select a Policy --</option>
                                            <option value="damage">Damaged Items Only (within 48 hours)</option>
                                            <option value="7-day">7-Day Hassle-Free Returns</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-8 pt-6 border-t border-gray-200 flex justify-between items-center">
                        <button id="step3-back-btn" type="button" class="secondary-btn">&larr; Back to Details</button>
                        <button id="step3-next-btn" type="button" class="main-btn" disabled>Next: Logistics &rarr;</button>
                    </div>
                </form>
            </div>

            <div id="step-4" class="hidden">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">Step 4: Logistics Information</h2>
                    <p class="text-gray-600 mt-2">Provide details for shipping and delivery.</p>
                </div>
                
                <form class="mt-8 flex flex-col space-y-6" id="logistics-form">
                    <div class="border border-gray-200 rounded-lg">
                        <button type="button" class="accordion-header active w-full flex justify-between items-center p-4 cursor-pointer bg-gray-50">
                            <span class="font-semibold text-lg text-gray-800">Shipping Details <span class="text-red-500">*</span></span>
                            <span class="arrow text-gray-500">▼</span>
                        </button>
                        <div class="accordion-content">
                            <div class="p-4 border-t border-gray-200">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6">
                                    <div class="form-group">
                                        <label for="weight" class="form-label">Weight (grams) <span class="text-red-500">*</span> <button type="button" class="help-btn" onclick="alert('Enter the weight of the product in grams. This will be used to calculate shipping costs.')">?</button></label>
                                        <input type="number" id="weight" value="" class="form-input mandatory-field-step4" placeholder="e.g., 500">
                                    </div>
                                    <div class="form-group">
                                        <div class="dimensions-label-group"> 
                                            <label class="form-label" for="length">Dimensions <span class="text-red-500">*</span></label>
                                            <select id="dimensions-unit-toggle" class="unit-toggle-select">
                                                <option value="cm">cm</option>
                                                <option value="inches">inches</option>
                                            </select>
                                            <button type="button" class="help-btn" onclick="alert('Enter the length, width, and height of the product in centimeters/inches.')">?</button>
                                        </div>
                                        <div class="flex gap-2 mt-1 dimensions-input-group"> 
                                            <input type="number" id="length" value="" class="form-input mandatory-field-step4" placeholder="Length">
                                            <input type="number" id="width" value="" class="form-input mandatory-field-step4" placeholder="Width">
                                            <input type="number" id="height" value="" class="form-input mandatory-field-step4" placeholder="Height">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="border border-gray-200 rounded-lg">
                        <button type="button" class="accordion-header w-full flex justify-between items-center p-4 cursor-pointer bg-gray-50">
                            <span class="font-semibold text-lg text-gray-800">Delivery Information <span class="text-red-500">*</span></span>
                            <span class="arrow text-gray-500">▼</span>
                        </button>
                        <div class="accordion-content">
                            <div class="p-4 border-t border-gray-200">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 items-center"> 
                                    <div class="form-group">
                                        <label for="shipping-region" class="form-label">Shipping Region <span class="text-red-500">*</span> <button type="button" class="help-btn" onclick="alert('Select the primary region(s) you ship this product to.')">?</button></label>
                                        <select id="shipping-region" class="form-input mandatory-field-step4">
                                            <option value="">-- Select Region --</option>
                                            <option value="domestic">Domestic (India Only)</option>
                                            <option value="asia">Asia</option>
                                            <option value="worldwide">Worldwide</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="delivery-time" class="form-label">Estimated Delivery Time (days) <span class="text-red-500">*</span> <button type="button" class="help-btn" onclick="alert('Provide an estimated delivery time in business days.')">?</button></label>
                                        <input type="number" id="delivery-time" value="" class="form-input mandatory-field-step4" placeholder="e.g., 5-7">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-8 pt-6 border-t border-gray-200 flex justify-between items-center">
                        <button id="step4-back-btn" type="button" class="secondary-btn">&larr; Back to Pricing</button>
                        <button id="step4-next-btn" type="button" class="main-btn" disabled>Next: Review &rarr;</button>
                    </div>
                </form>
            </div>

            <div id="step-5" class="hidden">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">Step 5: Review Your Listing</h2>
                    <p class="text-gray-600 mt-2">Please review all the details before publishing your product.</p>
                </div>

                <div class="space-y-6 pt-6 border-t border-gray-200">
                    <div class="review-section">
                        <h3 class="review-section-header">1. Product Identity & Images</h3>
                        <div class="review-item">
                            <span class="review-label">Product Images:</span>
                            <div id="review-images" class="review-value image-list">
                                </div>
                        </div>
                    </div>

                    <div class="review-section">
                        <h3 class="review-section-header">2. Product Details & Categorization</h3>
                        <div class="review-item">
                            <span class="review-label">Product Title:</span>
                            <span id="review-title" class="review-value"></span>
                        </div>
                        <div class="review-item">
                            <span class="review-label">Description:</span>
                            <span id="review-description" class="review-value"></span>
                        </div>
                        <div class="review-item">
                            <span class="review-label">Features:</span>
                            <ul id="review-features" class="review-value review-features-list"></ul>
                        </div>
                        <div class="review-item">
                            <span class="review-label">Keywords:</span>
                            <span id="review-keywords" class="review-value"></span>
                        </div>
                        <div class="review-item">
                            <span class="review-label">Category:</span>
                            <span id="review-category" class="review-value"></span>
                        </div>
                        <div class="review-item">
                            <span class="review-label">Material:</span>
                            <span id="review-material" class="review-value"></span>
                        </div>
                        <div class="review-item">
                            <span class="review-label">Color:</span>
                            <span id="review-color" class="review-value"></span>
                        </div>
                        <div class="review-item">
                            <span class="review-label">Size:</span>
                            <span id="review-size" class="review-value"></span>
                        </div>
                    </div>

                    <div class="review-section">
                        <h3 class="review-section-header">3. Pricing & Inventory</h3>
                        <div class="review-item">
                            <span class="review-label">MRP:</span>
                            <span id="review-mrp" class="review-value"></span>
                        </div>
                        <div class="review-item">
                            <span class="review-label">Selling Price:</span>
                            <span id="review-selling-price" class="review-value"></span>
                        </div>
                        <div id="review-group-buy-details" class="review-subsection hidden">
                            <div class="review-item">
                                <span class="review-label">Group Buy Enabled:</span>
                                <span class="review-value">Yes</span>
                            </div>
                            <div class="review-item">
                                <span class="review-label">Group Price:</span>
                                <span id="review-group-price" class="review-value"></span>
                            </div>
                            <div class="review-item">
                                <span class="review-label">Group MOQ:</span>
                                <span id="review-group-moq" class="review-value"></span>
                            </div>
                        </div>
                        <div id="review-wholesale-details" class="review-subsection hidden">
                            <div class="review-item">
                                <span class="review-label">Wholesale Enabled:</span>
                                <span class="review-value">Yes</span>
                            </div>
                            <div class="review-item">
                                <span class="review-label">Wholesale Price:</span>
                                <span id="review-wholesale-price" class="review-value"></span>
                            </div>
                            <div class="review-item">
                                <span class="review-label">Wholesale MOQ:</span>
                                <span id="review-wholesale-moq" class="review-value"></span>
                            </div>
                        </div>
                        <div class="review-item">
                            <span class="review-label">Total Stock:</span>
                            <span id="review-stock" class="review-value"></span>
                        </div>
                        <div class="review-item">
                            <span class="review-label">Return Policy:</span>
                            <span id="review-return-policy" class="review-value"></span>
                        </div>
                    </div>

                    <div class="review-section">
                        <h3 class="review-section-header">4. Logistics Information</h3>
                        <div class="review-item">
                            <span class="review-label">Weight:</span>
                            <span id="review-weight" class="review-value"></span>
                        </div>
                        <div class="review-item">
                            <span class="review-label">Dimensions:</span>
                            <span id="review-dimensions" class="review-value"></span>
                        </div>
                        <div class="review-item">
                            <span class="review-label">Shipping Region:</span>
                            <span id="review-shipping-region" class="review-value"></span>
                        </div>
                        <div class="review-item">
                            <span class="review-label">Delivery Time:</span>
                            <span id="review-delivery-time" class="review-value"></span>
                        </div>
                    </div>
                </div>

                <div class="mt-8 pt-6 border-t border-gray-200 flex justify-between items-center">
                    <button id="step5-back-btn" type="button" class="secondary-btn">&larr; Back to Logistics</button>
                    <button id="step5-submit-btn" type="button" class="main-btn">Submit Listing</button>
                </div>
            </div>

        </div>
    </div>

    <div id="upload-choice-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 shadow-xl w-full max-w-sm mx-auto">
            <h3 class="text-xl font-semibold mb-4 text-gray-900">Add an Image</h3>
            <button id="take-photo-btn" class="main-btn w-full mb-3 py-2">Take Photo with Camera</button>
            <button id="upload-gallery-btn" class="secondary-btn w-full py-2">Upload from Gallery</button>
            <button id="close-modal-btn" class="mt-4 text-gray-600 hover:text-gray-900 text-sm">Cancel</button>
        </div>
    </div>

    <script>
        // Global State (to carry data between steps)
        const productData = {
            images: new Array(4).fill(null), // For Step 1
            title: '', description: '', features: '', keywords: '', // For Step 2
            category: '', material: '', color: '', customColor: '', size: '', // For Step 2
            mrp: '', sellingPrice: '', enableGroupBuy: false, groupPrice: '', groupMoq: '', // For Step 3
            enableWholesale: false, wholesalePrice: '', wholesaleMoq: '', stock: '', returnPolicy: '', // For Step 3
            weight: '', length: '', width: '', height: '', dimensionsUnit: 'cm', shippingRegion: '', deliveryTime: '' // For Step 4
        };

        // --- Navigation Logic ---
        let currentStep = 1;
        const totalSteps = 5; 

        function showStep(stepNum) {
            // Hide all step divs explicitly
            document.getElementById('step-1').classList.add('hidden');
            document.getElementById('step-2').classList.add('hidden');
            document.getElementById('step-3').classList.add('hidden');
            document.getElementById('step-4').classList.add('hidden'); 
            document.getElementById('step-5').classList.add('hidden'); 

            // Show the requested step div
            const targetStepElement = document.getElementById(`step-${stepNum}`);
            if (targetStepElement) {
                targetStepElement.classList.remove('hidden');
            } else {
                console.error(`Error: Step ${stepNum} element not found.`);
                return; 
            }
            
            updateProgressBar(stepNum);
            currentStep = stepNum;

            // Specific actions when showing a step
            if (stepNum === 1) {
                renderSlots(); 
                validateStep1(); 
            }
            if (stepNum === 2) {
                updateStep2Image();
                populateStep2Fields(); 
                validateStep2(); 
            }
            if (stepNum === 3) {
                populateStep3Fields(); 
                setupAccordions(); 
                updatePricingExampleDisplay(); 
                validateStep3();
            }
            if (stepNum === 4) { 
                populateStep4Fields();
                setupAccordions(); 
                setupDimensionsToggle(); 
                validateStep4();
            }
            if (stepNum === 5) { 
                populateStep5Fields(); 
            }
        }

        function updateProgressBar(activeStep) {
            for (let i = 1; i <= totalSteps; i++) {
                const stepElement = document.getElementById(`progressStep${i}`);
                const circle = stepElement.querySelector('.progress-circle'); 
                const label = stepElement.querySelector('.progress-label'); 
                const line = document.getElementById(`progressLine${i-1}`); 

                stepElement.classList.remove('active', 'completed'); 
                circle.classList.remove('bg-yellow-400', 'text-black', 'bg-gray-200');
                
                if (line) { 
                    line.classList.remove('completed'); 
                }

                if (i < activeStep) {
                    stepElement.classList.add('completed'); 
                    circle.classList.add('bg-yellow-400', 'text-black');
                    circle.innerHTML = '✔'; 
                    if (line) line.classList.add('completed');
                } else if (i === activeStep) {
                    stepElement.classList.add('active'); 
                    circle.classList.add('bg-yellow-400', 'text-black');
                    circle.innerHTML = i;
                    if (line) line.classList.add('completed'); 
                } else {
                    circle.classList.add('bg-gray-200');
                    circle.innerHTML = i;
                }
            }
        }


        // --- Step 1 Logic (Image Upload) ---
        const fileInput = document.getElementById('file-upload');
        const slotsContainer = document.getElementById('image-upload-slots');
        const uploadChoiceModal = document.getElementById('upload-choice-modal'); 
        const step1NextBtn = document.getElementById('step1-next-btn');
        const statusMessage = document.getElementById('upload-status-message');
        const NUM_FILES = 4;
        let activeImageSlot = 0; 

        function renderSlots() {
            slotsContainer.innerHTML = '';
            for (let i = 0; i < NUM_FILES; i++) {
                const slot = document.createElement('div');
                slot.className = 'upload-slot'; 
                
                if (productData.images[i]) {
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(productData.images[i]);
                    img.alt = `Product Image ${i + 1}`; 
                    slot.appendChild(img);
                    const removeBtn = document.createElement('button');
                    removeBtn.innerHTML = '&times;';
                    removeBtn.className = 'remove-btn';
                    removeBtn.onclick = (e) => { 
                        e.stopPropagation(); 
                        URL.revokeObjectURL(img.src); 
                        productData.images[i] = null; 
                        renderSlots(); 
                        validateStep1(); 
                    };
                    slot.appendChild(removeBtn);

                    if (i === 0) {
                        const mainLabel = document.createElement('span');
                        mainLabel.className = 'main-image-label';
                        mainLabel.textContent = 'Main Pic'; 
                        slot.appendChild(mainLabel);
                    }

                } else {
                    const emptyContentDiv = document.createElement('div');
                    emptyContentDiv.className = 'empty-slot-content';
                    emptyContentDiv.innerHTML = `<span class="text-4xl">+</span><span class="block text-xs mt-1">${i === 0 ? 'Main Image' : `Image ${i + 1}`}</span>`;
                    slot.appendChild(emptyContentDiv);
                }
                
                slot.onclick = () => { 
                    if (!productData.images[i]) { 
                        activeImageSlot = i; 
                        uploadChoiceModal.classList.remove('hidden'); 
                    }
                };
                slotsContainer.appendChild(slot);
            }
        }

        function validateStep1() {
            const filledSlots = productData.images.filter(f => f !== null).length;
            step1NextBtn.disabled = filledSlots < NUM_FILES;
            
            if (filledSlots < NUM_FILES) {
                const remaining = NUM_FILES - filledSlots;
                statusMessage.textContent = `Please upload ${remaining} more image${remaining > 1 ? 's' : ''}.`; 
                statusMessage.style.color = '#EF4444'; 
            } else {
                statusMessage.textContent = 'All images uploaded. You can now continue.';
                statusMessage.style.color = '#16A34A'; 
            }
        }
        
        fileInput.addEventListener('change', (event) => {
            const selectedFiles = event.target.files;
            let currentFileIndex = 0; 

            let startFillingIndex = productData.images[activeImageSlot] === null ? activeImageSlot : productData.images.findIndex(file => file === null);
            if (startFillingIndex === -1 && selectedFiles.length > 0) { 
                alert("All image slots are full. Please remove existing images to upload new ones.");
                fileInput.value = ""; 
                return;
            }

            while (currentFileIndex < selectedFiles.length && startFillingIndex < NUM_FILES) {
                while (startFillingIndex < NUM_FILES && productData.images[startFillingIndex] !== null) {
                    startFillingIndex++;
                }

                if (startFillingIndex < NUM_FILES) { 
                    productData.images[startFillingIndex] = selectedFiles[currentFileIndex];
                    currentFileIndex++;
                } else { 
                    break;
                }
            }

            renderSlots();
            validateStep1();
            fileInput.value = ""; 
        });
        
        document.getElementById('close-modal-btn').addEventListener('click', () => uploadChoiceModal.classList.add('hidden'));
        document.getElementById('take-photo-btn').addEventListener('click', () => {
            uploadChoiceModal.classList.add('hidden');
            alert("This would open the device camera in the real application.");
        });
        document.getElementById('upload-gallery-btn').addEventListener('click', () => {
            uploadChoiceModal.classList.add('hidden');
            fileInput.click(); 
        });

        step1NextBtn.addEventListener('click', () => {
            showStep(2);
        });


        // --- Step 2 Logic (Details & Categorization) ---
        const colorSelect = document.getElementById('color-select');
        const customColorInput = document.getElementById('custom-color-input');
        const sizeSelect = document.getElementById('size');

        const mandatoryFieldsStep2 = document.querySelectorAll('.mandatory-field-step2');
        const step2NextBtn = document.getElementById('step2-next-btn');
        const step2BackBtn = document.getElementById('step2-back-btn');
        
        function updateStep2Image() {
            if (productData.images[0]) {
                document.getElementById('step2-main-image').src = URL.createObjectURL(productData.images[0]);
            }
        }

        function populateStep2Fields() {
            document.getElementById('title').value = productData.title || "Handcrafted Wooden Serving Tray";
            document.getElementById('description').value = productData.description || "A beautifully hand-painted wooden tray, perfect for serving guests or as a decorative piece. Made from sustainable Sheesham wood with intricate mosaic work.";
            document.getElementById('features').value = productData.features || "Handmade mosaic design\nDurable Sheesham wood\nPerfect for serving and display\nEasy to clean";
            document.getElementById('keywords').value = productData.keywords || "wooden serving tray, mosaic tray, gift set, kitchenware, home decor";
            
            const categorySelect = document.getElementById('category');
            categorySelect.value = productData.category || ""; 

            document.getElementById('material').value = productData.material || "Sheesham Wood";
            
            if (productData.color) {
                colorSelect.value = productData.color;
                if (productData.color === 'custom') { 
                    customColorInput.classList.remove('hidden');
                    customColorInput.value = productData.customColor || '';
                } else {
                    customColorInput.classList.add('hidden');
                }
            } else {
                colorSelect.value = ""; 
                customColorInput.classList.add('hidden');
            }

            sizeSelect.value = productData.size || ""; 
        }

        function validateStep2() {
            let allFilled = true;
            mandatoryFieldsStep2.forEach(field => {
                if (field.tagName === 'SELECT' && field.value.trim() === '') {
                    allFilled = false;
                } 
                else if (field.tagName !== 'SELECT' && field.value.trim() === '') {
                    allFilled = false;
                }
            });
            
            if (colorSelect.value === 'custom' && customColorInput.value.trim() === '') {
                allFilled = false;
            }
            step2NextBtn.disabled = !allFilled;
        }

        mandatoryFieldsStep2.forEach(field => {
            field.addEventListener('input', validateStep2);
            field.addEventListener('change', validateStep2); 
        });

        colorSelect.addEventListener('change', () => {
            if (colorSelect.value === 'custom') {
                customColorInput.classList.remove('hidden');
                customColorInput.value = ''; 
                customColorInput.focus();
            } else {
                customColorInput.classList.add('hidden');
            }
            validateStep2();
        });
        customColorInput.addEventListener('input', validateStep2); 

        sizeSelect.addEventListener('change', validateStep2);

        step2NextBtn.addEventListener('click', () => {
            productData.title = document.getElementById('title').value;
            productData.description = document.getElementById('description').value;
            productData.features = document.getElementById('features').value;
            productData.keywords = document.getElementById('keywords').value;
            productData.category = document.getElementById('category').value;
            productData.material = document.getElementById('material').value;
            
            if (colorSelect.value === 'custom') {
                productData.color = colorSelect.value; 
                productData.customColor = customColorInput.value; 
            } else {
                productData.color = colorSelect.value;
                productData.customColor = ''; 
            }
            
            productData.size = sizeSelect.value; 

            showStep(3); 
        });

        step2BackBtn.addEventListener('click', () => showStep(1));


        // --- Step 3 Logic (Pricing, Inventory & Policies) ---
        const mrpInput = document.getElementById('mrp'); 
        const sellingPriceInput = document.getElementById('selling-price');
        const groupBuyToggle = document.getElementById('enable-group-buy');
        const groupBuyPriceInput = document.getElementById('group-price');
        const groupMoqInput = document.getElementById('group-moq'); 
        const wholesaleToggle = document.getElementById('enable-wholesale');
        const wholesalePriceInput = document.getElementById('wholesale-price');
        const wholesaleMoqInput = document.getElementById('wholesale-moq'); 
        const mandatoryFieldsStep3 = document.querySelectorAll('.mandatory-field-step3');
        const step3NextBtn = document.getElementById('step3-next-btn');
        const step3BackBtn = document.getElementById('step3-back-btn');

        const displayedMrpExample = document.getElementById('displayed-mrp-example');
        const displayedSellingPriceExample = document.getElementById('displayed-selling-price-example');

        function setupAccordions() {
            const currentStepElement = document.getElementById(`step-${currentStep}`);
            if (!currentStepElement) return;

            const currentStepAccordions = currentStepElement.querySelectorAll('.accordion-header');

            currentStepAccordions.forEach(accordion => {
                accordion.removeEventListener('click', toggleAccordion); 
                accordion.addEventListener('click', toggleAccordion); 
            });

            if (currentStepAccordions.length > 0) {
                const firstAccordionOfCurrentStep = currentStepAccordions[0];
                if (!firstAccordionOfCurrentStep.classList.contains('active')) {
                    firstAccordionOfCurrentStep.click(); 
                }
            }
        }

        function toggleAccordion(event) {
            const accordion = event.currentTarget;
            const content = accordion.nextElementSibling;
            const arrow = accordion.querySelector('.arrow');

            const parentContainer = accordion.closest('form'); 
            
            if (content.style.maxHeight) { 
                content.style.maxHeight = null;
                accordion.classList.remove('active');
                if(arrow) arrow.style.transform = 'rotate(0deg)';
            } else {
                if (parentContainer) {
                    parentContainer.querySelectorAll('.accordion-header.active').forEach(openAccordionHeader => {
                        const openContent = openAccordionHeader.nextElementSibling;
                        if (openContent && openContent !== content) {
                            openContent.style.maxHeight = null;
                            openAccordionHeader.classList.remove('active');
                            const openArrow = openAccordionHeader.querySelector('.arrow');
                            if (openArrow) openArrow.style.transform = 'rotate(0deg)';
                        }
                    });
                }
                content.style.maxHeight = content.scrollHeight + "px"; 
                accordion.classList.add('active');
                if(arrow) arrow.style.transform = 'rotate(180deg)';
            }
        }
        
        groupBuyToggle.addEventListener('change', () => {
            const isDisabled = !groupBuyToggle.checked;
            groupBuyPriceInput.disabled = isDisabled;
            groupMoqInput.disabled = isDisabled;
            if (isDisabled) {
                groupBuyPriceInput.value = '';
                groupMoqInput.value = '';
            } else {
                const price = parseFloat(sellingPriceInput.value);
                if (!isNaN(price) && price > 0) {
                    groupBuyPriceInput.value = (price * 0.85).toFixed(0);
                }
            }
            validateStep3(); 
        });
        wholesaleToggle.addEventListener('change', () => {
            const isDisabled = !wholesaleToggle.checked;
            wholesalePriceInput.disabled = isDisabled;
            wholesaleMoqInput.disabled = isDisabled;
            if (isDisabled) {
                wholesalePriceInput.value = '';
                wholesaleMoqInput.value = '';
            } else {
                const price = parseFloat(sellingPriceInput.value);
                if (!isNaN(price) && price > 0) {
                    wholesalePriceInput.value = (price * 0.70).toFixed(0);
                }
            }
            validateStep3(); 
        });

        function updatePricingExampleDisplay() {
            const mrpValue = mrpInput.value;
            const sellingPriceValue = sellingPriceInput.value;

            if (mrpValue && !isNaN(parseFloat(mrpValue))) {
                displayedMrpExample.textContent = `₹${parseFloat(mrpValue).toLocaleString('en-IN')}`;
            } else {
                displayedMrpExample.textContent = '₹0'; 
            }

            if (sellingPriceValue && !isNaN(parseFloat(sellingPriceValue))) {
                displayedSellingPriceExample.textContent = `₹${parseFloat(sellingPriceValue).toLocaleString('en-IN')}`;
            } else {
                displayedSellingPriceExample.textContent = '₹0'; 
            }
        }

        mrpInput.addEventListener('input', () => {
            updatePricingExampleDisplay(); 
            validateStep3();
        });

        sellingPriceInput.addEventListener('input', () => {
            const price = parseFloat(sellingPriceInput.value);
            if (!isNaN(price) && price > 0) {
                if(groupBuyToggle.checked) groupBuyPriceInput.value = (price * 0.85).toFixed(0); 
                if(wholesaleToggle.checked) wholesalePriceInput.value = (price * 0.70).toFixed(0); 
            } else {
                if(groupBuyToggle.checked) groupBuyPriceInput.value = '';
                if(wholesaleToggle.checked) wholesalePriceInput.value = '';
            }
            updatePricingExampleDisplay(); 
            validateStep3();
        });

        function populateStep3Fields() {
            mrpInput.value = productData.mrp || "2000"; 
            sellingPriceInput.value = productData.sellingPrice || "1500"; 

            groupBuyToggle.checked = productData.enableGroupBuy;
            groupBuyPriceInput.value = productData.groupPrice || '';
            groupMoqInput.value = productData.groupMoq || '';
            groupBuyPriceInput.disabled = !groupBuyToggle.checked;
            groupMoqInput.disabled = !groupBuyToggle.checked; 

            wholesaleToggle.checked = productData.enableWholesale;
            wholesalePriceInput.value = productData.wholesalePrice || '';
            wholesaleMoqInput.value = productData.wholesaleMoq || '';
            wholesalePriceInput.disabled = !wholesaleToggle.checked;
            wholesaleMoqInput.disabled = !wholesaleToggle.checked;
            
            document.getElementById('stock').value = productData.stock || "200";
            document.getElementById('return-policy').value = productData.returnPolicy || ""; 
            
            updatePricingExampleDisplay(); 
        }

        function validateStep3() {
            let allFilled = true;
            mandatoryFieldsStep3.forEach(field => {
                if (field.tagName === 'SELECT' && field.value.trim() === '') {
                    allFilled = false;
                } else if (field.tagName !== 'SELECT' && field.value.trim() === '' && !field.disabled) { 
                    allFilled = false;
                } else if (field.type === 'number' && (isNaN(parseFloat(field.value)) || parseFloat(field.value) <= 0) && !field.disabled) {
                    allFilled = false;
                }
            });
            
            if (groupBuyToggle.checked) {
                if ((groupBuyPriceInput.value.trim() === '' || isNaN(parseFloat(groupBuyPriceInput.value)) || parseFloat(groupBuyPriceInput.value) <= 0) && !groupBuyPriceInput.disabled) allFilled = false;
                if ((groupMoqInput.value.trim() === '' || isNaN(parseInt(groupMoqInput.value)) || parseInt(groupMoqInput.value) <= 0) && !groupMoqInput.disabled) allFilled = false;
            }
            if (wholesaleToggle.checked) {
                if ((wholesalePriceInput.value.trim() === '' || isNaN(parseFloat(wholesalePriceInput.value)) || parseFloat(wholesalePriceInput.value) <= 0) && !wholesalePriceInput.disabled) allFilled = false;
                if ((wholesaleMoqInput.value.trim() === '' || isNaN(parseInt(wholesaleMoqInput.value)) || parseInt(wholesaleMoqInput.value) <= 0) && !wholesaleMoqInput.disabled) allFilled = false;
            }

            step3NextBtn.disabled = !allFilled;
        }

        document.getElementById('mrp').addEventListener('input', validateStep3);
        document.getElementById('selling-price').addEventListener('input', validateStep3);
        document.getElementById('stock').addEventListener('input', validateStep3);
        document.getElementById('return-policy').addEventListener('change', validateStep3); 

        groupBuyToggle.addEventListener('change', validateStep3);
        groupBuyPriceInput.addEventListener('input', validateStep3);
        groupMoqInput.addEventListener('input', validateStep3);
        
        wholesaleToggle.addEventListener('change', validateStep3);
        wholesalePriceInput.addEventListener('input', validateStep3);
        wholesaleMoqInput.addEventListener('input', validateStep3);


        step3NextBtn.addEventListener('click', () => {
            productData.mrp = document.getElementById('mrp').value;
            productData.sellingPrice = document.getElementById('selling-price').value;
            productData.enableGroupBuy = groupBuyToggle.checked;
            productData.groupPrice = groupBuyToggle.checked ? groupBuyPriceInput.value : '';
            productData.groupMoq = groupBuyToggle.checked ? groupMoqInput.value : '';
            productData.enableWholesale = wholesaleToggle.checked;
            productData.wholesalePrice = wholesaleToggle.checked ? wholesalePriceInput.value : '';
            productData.wholesaleMoq = wholesaleToggle.checked ? wholesaleMoqInput.value : '';
            productData.stock = document.getElementById('stock').value;
            productData.returnPolicy = document.getElementById('return-policy').value;

            showStep(4); 
        });

        step3BackBtn.addEventListener('click', () => showStep(2));


        // --- Step 4 Logic (Logistics Information) ---
        const weightInput = document.getElementById('weight');
        const lengthInput = document.getElementById('length');
        const widthInput = document.getElementById('width');
        const heightInput = document.getElementById('height');
        const shippingRegionSelect = document.getElementById('shipping-region');
        const deliveryTimeInput = document.getElementById('delivery-time');
        const mandatoryFieldsStep4 = document.querySelectorAll('.mandatory-field-step4');
        const step4NextBtn = document.getElementById('step4-next-btn');
        const step4BackBtn = document.getElementById('step4-back-btn');
        const dimensionsUnitToggle = document.getElementById('dimensions-unit-toggle'); 

        function setupDimensionsToggle() { 
            dimensionsUnitToggle.removeEventListener('change', handleDimensionsUnitChange); 
            dimensionsUnitToggle.addEventListener('change', handleDimensionsUnitChange);
            updateDimensionsPlaceholders(dimensionsUnitToggle.value);
        }

        function handleDimensionsUnitChange() { 
            const selectedUnit = dimensionsUnitToggle.value;
            updateDimensionsPlaceholders(selectedUnit);
        }

        function updateDimensionsPlaceholders(unit) { 
            lengthInput.placeholder = `Length (${unit})`;
            widthInput.placeholder = `Width (${unit})`;
            heightInput.placeholder = `Height (${unit})`;
        }


        function populateStep4Fields() {
            weightInput.value = productData.weight;
            lengthInput.value = productData.length;
            widthInput.value = productData.width;
            heightInput.value = productData.height;
            shippingRegionSelect.value = productData.shippingRegion;
            deliveryTimeInput.value = productData.deliveryTime;
            dimensionsUnitToggle.value = productData.dimensionsUnit || 'cm'; 
            updateDimensionsPlaceholders(dimensionsUnitToggle.value); 
        }

        function validateStep4() {
            let allFilled = true;
            mandatoryFieldsStep4.forEach(field => {
                if (field.tagName === 'SELECT' && field.value.trim() === '') {
                    allFilled = false;
                } else if (field.tagName !== 'SELECT' && field.value.trim() === '') {
                    allFilled = false;
                } else if (field.type === 'number' && (isNaN(parseFloat(field.value)) || parseFloat(field.value) <= 0)) {
                    allFilled = false;
                }
            });
            step4NextBtn.disabled = !allFilled;
        }

        weightInput.addEventListener('input', validateStep4);
        lengthInput.addEventListener('input', validateStep4);
        widthInput.addEventListener('input', validateStep4);
        heightInput.addEventListener('input', validateStep4);
        shippingRegionSelect.addEventListener('change', validateStep4);
        deliveryTimeInput.addEventListener('input', validateStep4);

        step4NextBtn.addEventListener('click', () => {
            productData.weight = weightInput.value;
            productData.length = lengthInput.value;
            productData.width = widthInput.value;
            productData.height = heightInput.value;
            productData.shippingRegion = shippingRegionSelect.value;
            productData.deliveryTime = deliveryTimeInput.value;
            productData.dimensionsUnit = dimensionsUnitToggle.value; 

            showStep(5); 
        });

        step4BackBtn.addEventListener('click', () => showStep(3));

        // --- Step 5 Logic (Review) ---
        const step5BackBtn = document.getElementById('step5-back-btn');
        const step5SubmitBtn = document.getElementById('step5-submit-btn');

        function populateStep5Fields() {
            // Section 1: Product Identity & Images
            const reviewImagesContainer = document.getElementById('review-images');
            reviewImagesContainer.innerHTML = ''; 
            if (productData.images && productData.images.length > 0) {
                productData.images.forEach(imgFile => {
                    if (imgFile) {
                        const imgElement = document.createElement('img');
                        imgElement.src = URL.createObjectURL(imgFile);
                        imgElement.alt = "Product Image";
                        imgElement.className = "review-image";
                        reviewImagesContainer.appendChild(imgElement);
                    }
                });
            } else {
                reviewImagesContainer.innerHTML = '<span class="text-gray-500">No images uploaded.</span>';
            }

            // Section 2: Product Details & Categorization
            document.getElementById('review-title').textContent = productData.title || 'N/A';
            document.getElementById('review-description').textContent = productData.description || 'N/A';
            
            const reviewFeaturesList = document.getElementById('review-features');
            reviewFeaturesList.innerHTML = '';
            if (productData.features) {
                productData.features.split('\n').forEach(feature => {
                    if (feature.trim()) {
                        const li = document.createElement('li');
                        li.textContent = feature.trim();
                        reviewFeaturesList.appendChild(li);
                    }
                });
            } else {
                reviewFeaturesList.innerHTML = '<li class="text-gray-500">N/A</li>';
            }

            document.getElementById('review-keywords').textContent = productData.keywords || 'N/A';
            document.getElementById('review-category').textContent = productData.category || 'N/A';
            document.getElementById('review-material').textContent = productData.material || 'N/A';
            
            let colorText = productData.color;
            if (productData.color === 'custom' && productData.customColor) {
                colorText = productData.customColor + ' (Custom)';
            } else if (!productData.color) {
                colorText = 'N/A';
            }
            document.getElementById('review-color').textContent = colorText;

            document.getElementById('review-size').textContent = productData.size || 'N/A';

            // Section 3: Pricing & Inventory
            document.getElementById('review-mrp').textContent = productData.mrp ? `₹${parseFloat(productData.mrp).toLocaleString('en-IN')}` : 'N/A';
            document.getElementById('review-selling-price').textContent = productData.sellingPrice ? `₹${parseFloat(productData.sellingPrice).toLocaleString('en-IN')}` : 'N/A';
            
            const reviewGroupBuyDetails = document.getElementById('review-group-buy-details');
            if (productData.enableGroupBuy) {
                reviewGroupBuyDetails.classList.remove('hidden');
                document.getElementById('review-group-price').textContent = productData.groupPrice ? `₹${parseFloat(productData.groupPrice).toLocaleString('en-IN')}` : 'N/A';
                document.getElementById('review-group-moq').textContent = productData.groupMoq || 'N/A';
            } else {
                reviewGroupBuyDetails.classList.add('hidden');
            }

            const reviewWholesaleDetails = document.getElementById('review-wholesale-details');
            if (productData.enableWholesale) {
                reviewWholesaleDetails.classList.remove('hidden');
                document.getElementById('review-wholesale-price').textContent = productData.wholesalePrice ? `₹${parseFloat(productData.wholesalePrice).toLocaleString('en-IN')}` : 'N/A';
                document.getElementById('review-wholesale-moq').textContent = productData.wholesaleMoq || 'N/A';
            } else {
                reviewWholesaleDetails.classList.add('hidden');
            }

            document.getElementById('review-stock').textContent = productData.stock || 'N/A';
            let returnPolicyText = 'N/A';
            if (productData.returnPolicy === 'damage') {
                returnPolicyText = 'Damaged Items Only (within 48 hours)';
            } else if (productData.returnPolicy === '7-day') {
                returnPolicyText = '7-Day Hassle-Free Returns';
            }
            document.getElementById('review-return-policy').textContent = returnPolicyText;

            // Section 4: Logistics Information
            document.getElementById('review-weight').textContent = productData.weight ? `${productData.weight} grams` : 'N/A';
            const dimensionsUnit = productData.dimensionsUnit || 'cm';
            document.getElementById('review-dimensions').textContent = (productData.length && productData.width && productData.height) ? 
                `${productData.length}${dimensionsUnit} L x ${productData.width}${dimensionsUnit} W x ${productData.height}${dimensionsUnit} H` : 'N/A';
            document.getElementById('review-shipping-region').textContent = productData.shippingRegion || 'N/A';
            document.getElementById('review-delivery-time').textContent = productData.deliveryTime ? `${productData.deliveryTime} days` : 'N/A';
        }

        step5BackBtn.addEventListener('click', () => showStep(4));
        step5SubmitBtn.addEventListener('click', () => {
            alert("Congratulations! Your product listing has been submitted.");
            console.log("Final Product Data:", productData);
        });

        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('step-1').classList.add('hidden');
            document.getElementById('step-2').classList.add('hidden');
            document.getElementById('step-3').classList.add('hidden');
            document.getElementById('step-4').classList.add('hidden');
            document.getElementById('step-5').classList.add('hidden'); 
            
            showStep(1); 
        });
    </script>
</body>
</html>